################################################################################
#########|                                                            |#########
#########|             Fichier de génération de la police             |#########
#########|____________________________________________________________|#########
################################################################################





#---------------------------< Imports des modules >----------------------------#


import pygame as pg  # Moteur du jeu (utilisé ici pour générer des sprites)
from ast import literal_eval # Utilisé pour une évaluation sécurisé des expressions



#---------------------------------< Données >----------------------------------#


# Définition des sprites des charactères
POLICE = {
    "A": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "B": [
        "     ",
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "C": [
        "     ",
        " ####",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "D": [
        "     ",
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "E": [
        "     ",
        "#####",
        "#    ",
        "#    ",
        "###  ",
        "#    ",
        "#    ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "F": [
        "     ",
        "#####",
        "#    ",
        "#    ",
        "###  ",
        "#    ",
        "#    ",
        "#    ",
        "     ",
        "     ",
        "     "
        ],

    "G": [
        "     ",
        " ### ",
        "#    ",
        "#    ",
        "#    ",
        "# ###",
        "#  # ",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "H": [
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "I": [
        "     ",
        "#####",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "J": [
        "     ",
        "#####",
        "   # ",
        "   # ",
        "   # ",
        "   # ",
        "#  # ",
        " ##  ",
        "     ",
        "     ",
        "     "
        ],

    "K": [
        "     ",
        "#   #",
        "#   #",
        "#  # ",
        "###  ",
        "#  # ",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "L": [
        "     ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "M": [
        "     ",
        "#   #",
        "## ##",
        "# # #",
        "# # #",
        "#   #",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "N": [
        "     ",
        "#   #",
        "##  #",
        "# # #",
        "# # #",
        "# # #",
        "#  ##",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "O": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "P": [
        "     ",
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "#    ",
        "#    ",
        "#    ",
        "     ",
        "     ",
        "     "
        ],

    "Q": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        "# # #",
        "#  ##",
        " ### ",
        "    #",
        "     ",
        "     "
        ],

    "R": [
        "     ",
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "# #  ",
        "#  # ",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "S": [
        "     ",
        " ####",
        "#    ",
        "#    ",
        " ### ",
        "    #",
        "    #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "T": [
        "     ",
        "#####",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "U": [
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "V": [
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "W": [
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "# # #",
        "# # #",
        " # # ",
        "     ",
        "     ",
        "     "
        ],

    "X": [
        "     ",
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        " # # ",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "Y": [
        "     ",
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "Z": [
        "     ",
        "#####",
        "    #",
        "   # ",
        "  #  ",
        " #   ",
        "#    ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "a": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "    #",
        " ####",
        "#   #",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "b": [
        "#    ",
        "#    ",
        "#    ",
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "c": [
        "    ",
        "    ",
        "    ",
        " ###",
        "#   ",
        "#   ",
        "#   ",
        " ###",
        "    ",
        "    ",
        "    "
        ],

    "d": [
        "    #",
        "    #",
        "    #",
        " ####",
        "#   #",
        "#   #",
        "#   #",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "e": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "f": [
        "    ",
        "  ##",
        " #  ",
        "### ",
        " #  ",
        " #  ",
        " #  ",
        " #  ",
        "    ",
        "    ",
        "    "
        ],

    "g": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        " ####",
        "    #",
        "#   #",
        " ### "
        ],

    "h": [
        "#    ",
        "#    ",
        "#    ",
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "i": [
        " ",
        "#",
        " ",
        "#",
        "#",
        "#",
        "#",
        "#",
        " ",
        " ",
        " "
        ],

    "j": [
        "    ",
        "    ",
        "    ",
        "   #",
        "    ",
        "####",
        "   #",
        "   #",
        "   #",
        "#  #",
        " ##  "
        ],

    "k": [
        "     ",
        "     ",
        "     ",
        "#   #",
        "#  # ",
        "###  ",
        "#  # ",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "l": [
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        " ",
        " ",
        " "
        ],

    "m": [
        "     ",
        "     ",
        "     ",
        " # # ",
        "# # #",
        "# # #",
        "# # #",
        "# # #",
        "     ",
        "     ",
        "     "
        ],

    "n": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "o": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "p": [
        "     ",
        "     ",
        "     ",
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#### ",
        "#    ",
        "#    ",
        "#    "
        ],

    "q": [
        "     ",
        "     ",
        "     ",
        " ####",
        "#   #",
        "#   #",
        "#   #",
        " ####",
        "    #",
        "    #",
        "    #"
        ],

    "r": [
        "     ",
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#    ",
        "#    ",
        "#    ",
        "     ",
        "     ",
        "     "
        ],

    "s": [
        "     ",
        "     ",
        "     ",
        " ####",
        "#    ",
        " ### ",
        "    #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "t": [
        "    ",
        " #  ",
        " #  ",
        "### ",
        " #  ",
        " #  ",
        " #  ",
        "  ##",
        "    ",
        "    ",
        "    "
        ],

    "u": [
        "     ",
        "     ",
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "v": [
        "     ",
        "     ",
        "     ",
        "#   #",
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "w": [
        "     ",
        "     ",
        "     ",
        "#   #",
        "#   #",
        "# # #",
        "# # #",
        " # # ",
        "     ",
        "     ",
        "     "
        ],

    "x": [
        "     ",
        "     ",
        "     ",
        "#   #",
        " # # ",
        "  #  ",
        " # # ",
        "#   #",
        "     ",
        "     ",
        "     "
        ],

    "y": [
        "     ",
        "     ",
        "     ",
        "#   #",
        " # # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "z": [
        "     ",
        "     ",
        "     ",
        "#####",
        "   # ",
        "  #  ",
        " #   ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "à": [
        " ##  ",
        "   # ",
        "     ",
        " ### ",
        "    #",
        " ####",
        "#   #",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "ç": [
        "    ",
        "    ",
        "    ",
        " ###",
        "#   ",
        "#   ",
        "#   ",
        " ###",
        "  # ",
        "   #",
        " ## "
        ],

    "é": [
        "  ## ",
        " #   ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "è": [
        " ##  ",
        "   # ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "ê": [
        "  #  ",
        " # # ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "ë": [
        "     ",
        " # # ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ####",
        "     ",
        "     ",
        "     "
        ],

    "î": [
        " # ",
        "# #",
        "   ",
        " # ",
        " # ",
        " # ",
        " # ",
        " # ",
        "   ",
        "   ",
        "   "
        ],

    "ï": [
        "   ",
        "# #",
        "   ",
        " # ",
        " # ",
        " # ",
        " # ",
        " # ",
        "   ",
        "   ",
        "   "
        ],

    "ô": [
        "  #  ",
        " # # ",
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "ù": [
        " ##  ",
        "   # ",
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "û": [
        "  #  ",
        " # # ",
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "0": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "# # #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "1": [
        "     ",
        "  #  ",
        " ##  ",
        "# #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "2": [
        "     ",
        " ### ",
        "#   #",
        "    #",
        "   # ",
        "  #  ",
        " #   ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "3": [
        "     ",
        "#### ",
        "    #",
        "    #",
        " ### ",
        "    #",
        "    #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "4": [
        "     ",
        "   # ",
        "  ## ",
        " # # ",
        "#  # ",
        "#####",
        "   # ",
        "   # ",
        "     ",
        "     ",
        "     "
        ],

    "5": [
        "     ",
        "#####",
        "#    ",
        "#    ",
        "#### ",
        "    #",
        "    #",
        "#### ",
        "     ",
        "     ",
        "     "
        ],

    "6": [
        "     ",
        " ### ",
        "#    ",
        "#    ",
        "#### ",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "7": [
        "     ",
        "#####",
        "    #",
        "   # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "8": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        " ### ",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    "9": [
        "     ",
        " ### ",
        "#   #",
        "#   #",
        " ####",
        "    #",
        "    #",
        " ### ",
        "     ",
        "     ",
        "     "
        ],

    ".": [
        " ",
        " ",
        " ",
        " ",
        " ",
        " ",
        " ",
        "#",
        " ",
        " ",
        " "
        ],

    ":": [
        " ",
        " ",
        " ",
        " ",
        "#",
        " ",
        " ",
        "#",
        " ",
        " ",
        " "
        ],

    ";": [
        "  ",
        "  ",
        "  ",
        "  ",
        " #",
        "  ",
        "  ",
        " #",
        " #",
        "# ",
        "  "
        ],

    ",": [
        "  ",
        "  ",
        "  ",
        "  ",
        "  ",
        "  ",
        "  ",
        " #",
        " #",
        "# ",
        "  "
        ],

    "!": [
        " ",
        "#",
        "#",
        "#",
        "#",
        "#",
        " ",
        "#",
        " ",
        " ",
        " "
        ],

    "?": [
        "     ",
        " ### ",
        "#   #",
        "   # ",
        "  #  ",
        "  #  ",
        "     ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "%": [
        "     ",
        "##  #",
        "## # ",
        "   # ",
        "  #  ",
        " #   ",
        " # ##",
        "#  ##",
        "     ",
        "     ",
        "     "
        ],

    "/": [
        "     ",
        "    #",
        "   # ",
        "   # ",
        "  #  ",
        " #   ",
        " #   ",
        "#    ",
        "     ",
        "     ",
        "     "
        ],

    "\\": [
        "     ",
        "#    ",
        " #   ",
        " #   ",
        "  #  ",
        "   # ",
        "   # ",
        "    #",
        "     ",
        "     ",
        "     "
        ],

    "+": [
        "     ",
        "     ",
        "     ",
        "  #  ",
        "  #  ",
        "#####",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     "
        ],

    "-": [
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "#####",
        "     ",
        "     ",
        "     ",
        "     ",
        "     "
        ],

    "=": [
        "     ",
        "     ",
        "     ",
        "     ",
        "#####",
        "     ",
        "#####",
        "     ",
        "     ",
        "     ",
        "     "
        ],

    "[": [
        "###",
        "#  ",
        "#  ",
        "#  ",
        "#  ",
        "#  ",
        "#  ",
        "###",
        "   ",
        "   ",
        "   "
        ],

    "]": [
        "###",
        "  #",
        "  #",
        "  #",
        "  #",
        "  #",
        "  #",
        "###",
        "   ",
        "   ",
        "   "
        ],

    "(": [
        " #",
        "# ",
        "# ",
        "# ",
        "# ",
        "# ",
        "# ",
        " #",
        "  ",
        "  ",
        "  "
        ],

    ")": [
        "# ",
        " #",
        " #",
        " #",
        " #",
        " #",
        " #",
        "# ",
        "  ",
        "  ",
        "  "
        ],

    "\"": [
        "# #",
        "# #",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
        ],

    "'": [
        "#",
        "#",
        " ",
        " ",
        " ",
        " ",
        " ",
        " ",
        " ",
        " ",
        " "
        ],

    " ": [
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
        ],

    ">": [
        "   ",
        "   ",
        "   ",
        "#  ",
        " # ",
        "  #",
        " # ",
        "#  ",
        "   ",
        "   ",
        "   "
        ],

    "<": [
        "   ",
        "   ",
        "   ",
        "  #",
        " # ",
        "#  ",
        " # ",
        "  #",
        "   ",
        "   ",
        "   "
        ],

    "|": [
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#",
        "#"
        ],

    "°": [
        "###",
        "# #",
        "###",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
        ],
    "_": [
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "#####",
        "     ",
        "     ",
        "     "
        ],

    "#": [
        "     ",
        " # # ",
        " # # ",
        "#####",
        " # # ",
        "#####",
        " # # ",
        " # # ",
        "     ",
        "     ",
        "     "
        ],

    "^": [
        " # ",
        "# #",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
        ],

    "~": [
        "     ",
        "     ",
        "     ",
        "     ",
        " #   ",
        "# # #",
        "   # ",
        "     ",
        "     ",
        "     ",
        "     "
        ],

    "¤": [
        "#####",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#####"
        ],

    "\n": [""]

    }


# Dictionnaire contenant la taille de tous les charactères
LDIM = {key: len(value[0]) for key, value in POLICE.items()}



#---------------------------< Fonction principale >----------------------------#


# Dictionnaire contenant toutes les polices d'écriture
polices = {} # {taille: {couleur(rgb): {charactère: surface}}}


def genererPolice(taille: int=1, couleur: tuple=(255, 255, 255)) -> None:

    # Insertion de nouvelles clés dans le dictionnaire de police
    if not taille in polices:
        polices[taille] = {}
    polices[taille][couleur] = {}

    couleur_bis = (0, 0, 0) if couleur != (0, 0, 0) else (255, 255, 255) # Couleur d'arrière plan (sera supprimée)

    for lettre in POLICE: # Génération d'un sprite pour toutes les lettres utilisées

        sprite = pg.surface.Surface((taille*LDIM[lettre], taille*11)) # Génération d'une surface pour la lettre
        sprite.fill(couleur_bis) # Remplissage de l'arrière plan

        # Ajout de tous les pixels colorés
        for y, ligne in enumerate(POLICE[lettre]):
            for x, pixel in enumerate(ligne):
                if pixel != " ":
                    pg.draw.rect(sprite, couleur, ((x*taille, y*taille), (taille, taille)))

        sprite.set_colorkey(couleur_bis) # Mise en transparence de l'arrière plan
        polices[taille][couleur][lettre] = sprite # Ajout de la lettre finalisé à la police d'écriture


def zoneTexte(texte: str, taille: int=1) -> pg.surface.Surface:
    """Permet de générer une surface contenant du texte"""

    # Le symbole "$" permet de séparer couleurs et texte
    texte = texte.split("$") # Couleur, texte, couleur, texte, etc...

    if "".join(texte) == "": # Si il n'y a pas de texte
        return pg.surface.Surface((0, 0)) # Surface vide

    # Remplacement automatique des charactères sans sprite
    for num, ligne in enumerate(texte):
        for lettre in ligne:
            if lettre not in POLICE:
                texte[num] = texte[num].replace(lettre, "¤")

    # Couleurs du texte
    couleurs = [literal_eval(couleur) for couleur in texte[::2]]

    # Couleur d'arrière plan (sera supprimée)
    couleur_bis = (1, 1, 1)

    # Génération de la police d'écriture si elle n'a pas encore été créée
    if taille not in polices:
        for couleur in couleurs:
            genererPolice(taille, couleur)
    else:
        for couleur in couleurs:
            if couleur not in polices[taille]:
                genererPolice(taille, couleur)

    lLignes = []
    for ligne in "".join(texte[1::2]).split("\n"):
        lLigne = -1
        for lettre in ligne:
            lLigne += (LDIM[lettre] + 1)
        lLignes.append(lLigne)

    # Génération de la zone de texte est disposition des lettres
    surface = pg.surface.Surface((taille*max(lLignes), taille*len(lLignes)*12 - 1)) # Surface sur laquelle sera écrit le texte
    surface.fill(couleur_bis) # Remplissage de l'arrière plan

    # Ajout à la surface de toutes les lettres
    nbCouleur = 0
    for i, ligne in enumerate([ligne for ligne in "$".join(texte[1::2]).split("\n")]):

        posX, posY = 0, i*taille*12
        for lettre in ligne:

            if lettre == "$": # Symbole pour changer de couleur
                nbCouleur += 1
                continue

            surface.blit(polices[taille][couleurs[nbCouleur]][lettre], (posX, posY))
            posX += taille * (LDIM[lettre] + 1)

    surface.set_colorkey(couleur_bis) # Mise en transparence de l'arrière plan

    return surface # Return de la surface finale